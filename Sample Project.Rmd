---
title: "Tuition prediction modeling"
---

```{r}
library(tidyverse)
library(readr)
library(patchwork)
library(ggridges)
library(janitor)
theme_set(theme_bw())
knitr::opts_chunk$set(echo = FALSE) # Prevents code from showing in the pdf.

# Downloaded from https://survey.stackoverflow.co/
education_costs <- read_csv("C:/Users/Лиза/Desktop/DATA100 R/DATA100-FINAL-PROJECT/International_Education_Costs.csv", show_col_types = FALSE)

glimpse(education_costs) #remove later
summary(education_costs)
```

# Introduction

<<I'll use double angle brackets to point out what I'm doing at each point.>>

<<Here, I'm describing the data in general. I want to give the reader enough information to ask the same questions as me, without actually stating my research goals.>>

StackOverflow is the go-to location for developers, data scientists, and students trying to solve coding issues that they are facing. Each year, they survey their users to get an idea of the demographics. In this survey, they include their job, education level, and their income, along with how they learned to code.

# Goals

In this work, I'll look at how education level affects income. I'm restricting my analysis to people who code in R or python who work in a data-related field.

# Basic Data Cleaning

At the first quick glance, the current dataset seems to be usable, but not fully ready for modeling. Several cleaning steps are necessary to ensure that the data is tidy, consistent and suitable for analysis.

First of all, we need to make sure that our variables have appropriate data types: quantitative should be numeric, qualitative should be factor. We selected these variables and mutate them into an appropriate data type.

Second of all, Character columns sometimes contained unnecessary white space (leading or trailing spaces). All character variables were cleaned using str_trim() to ensure consistency when grouping or filtering.

Third of all, the dataset was inspected for missing values. Rows with missing values in essential cost related variables (tuition, rent, insurance, visa fees) were removed, as they would prevent accurate modeling.

Lastly, we created a couple of new variables to better support modeling and analysis: Annual rent (annual_rent), Total annual cost (total_annual_cost) and Local currency tuition with rent (was adjusted based on exchange currency) - these variables can improve predictive performance and provide more meaningful insights.

For further analysis and visualization, we also reshaped cost related variables using pivot_longer(), resulting in cost_type and cost_value columns. It will be useful for comparing cost categories across countries or institutions.
  

```{r}
# Cleaning before modeling
education_cleaned <- education_costs |>
  clean_names() |>
  mutate(across(where(is.character), str_trim)) |>
  mutate(
    country = factor(country),
    city  = factor(city),
    university = factor(university),
    program = factor(program),
    level = factor(level)
  ) |>
  mutate(
    tuition_usd = as.numeric(tuition_usd),
    rent_usd  = as.numeric(rent_usd),
    insurance_usd = as.numeric(insurance_usd),
    visa_fee_usd = as.numeric(visa_fee_usd),
    exchange_rate = as.numeric(exchange_rate)
  ) |>
  mutate(
    annual_rent = rent_usd * 12,
    total_annual_cost = tuition_usd + annual_rent + insurance_usd + visa_fee_usd,
    tuition_local = tuition_usd / exchange_rate,
    rent_local  = rent_usd / exchange_rate
  ) |>
  filter(
    !is.na(tuition_usd),
    !is.na(rent_usd),
    !is.na(insurance_usd),
    !is.na(visa_fee_usd)
  )

education_long <- education_cleaned |>
  pivot_longer(
    cols = c(tuition_usd, rent_usd, insurance_usd, visa_fee_usd),
    names_to = "cost_type",
    values_to = "cost_value"
  )

education_cleaned
education_long
```


# Exploratory Plots

Visualization is an essential part of teh Exploratory Data Analysis. Here, we will explore how does the tuition vary and relate to other factors that could impact it, by using 3 plots.

## Plot 1: How does tuition relate to the living cost index?

```{r}
plot1 <- education_cleaned |> 
  ggplot(aes(x = living_cost_index, y = tuition_usd)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Tuition vs Living Cost Index")
plot1

```

- Countries with higher living costs generally appear to have higher tuition fees. This suggests that cost of living and tuition may be influenced by similar economic factors.

- Although the trend is positive, the points are widely scattered around the trend line. Living cost index alone does not strongly predict tuition. There are likely other important variables influencing tuition

- High tuition but moderate living costs, and Low tuition in countries with relatively high living costs.

Here, we can conclude that this plot shows a large variation. Thus, adding other factors/predictors could improve explaining the differences in tuition.


## Plot 2: Work/Code Experience

```{r}
library(corrplot)

numeric_df <- education_cleaned |> 
  select(tuition_usd, living_cost_index, duration_years)

corrplot(cor(numeric_df), method = "circle")




```

- Older people are more likely to have had to learn to code *after* they started working. Younger people have learned to code before they entered the workforce.
- Regardless of age group, the slope of the points appears to be 1 - people have been coding at the same rate as they've been working, regardless of when they started either.
- Those 65 year-olds have been coding for a long time!!!
    - This probably says something about the data collection! The data only includes programmers/data scientists, so there's a bias as to who we're looking at.

## Plot 3: Experience and Language

```{r}
so_cad |>
    filter(!Age %in% c("Prefer not to say", "Under 18 years old")) |>
    select(Age, CompCAD, YearsCode, r, python, julia, sql) |>
    pivot_longer(-c(Age, CompCAD, YearsCode)) |>
    filter(value) |>
    select(-value) |>
    ggplot() +
    aes(x = YearsCode, y = name, fill = name) +
    geom_density_ridges(bandwidth = 1.5, alpha = 0.75, rel_min_height = 0.05) +
    facet_wrap(~ Age)
```

- Most people who learned Julia have already been programming for a long time; in other words, people only learn Julia once they're comfortable with other languages.
- 65 year-olds only know Python.
- Distribution for R and Python are similar - looks like people are learning them at similar rates!
    - Due to the nature of pivoting, the "R" and the "Python" plots will include many of the same people.


# Model Plots

<<I give three plots just to give your more examples of the plots you might want to make.>>

## Model Plot 1: Wage and Coding Experience

```{r}
so_cad |>
    select(CompCAD, YearsCode, r, python, julia, sql) |>
    pivot_longer(-c(CompCAD, YearsCode)) |>
    filter(value) |>
    select(-value) |>
    ggplot() +
    aes(x = YearsCode, y = CompCAD, colour = name) +
    geom_point() +
    geom_smooth(se = FALSE, formula = y ~ x, method = "lm") +
    facet_wrap(~ name)
```

In the plot above, note that *many* of the points are the same across facets. The people in the "python" plot very likely know another language.

- Regardless of which language you learn, more experience seems to increase your pay.

## Model Plot 2: Wage and Language (LangWage?)

```{r}

colour_by_language <- function(language) {
    ggplot(filter(so_cad, CompCAD < 500000)) +
        aes(y = CompCAD, x = Langs, fill = {{ language }}) +
        geom_boxplot() +
        coord_flip() +
        scale_fill_manual(
            values = c("red", "green")
        ) +
        labs(
            x = "Compensation (Canadian Dollars)",
            y = NULL,
            title = substitute(language),
            fill = "Language Present?"
        )
}

gg_r <- colour_by_language(r)
gg_p <- colour_by_language(python)
gg_s <- colour_by_language(sql)
gg_j <- colour_by_language(julia)

gg_r + gg_p + gg_s + gg_j +
    plot_layout(nrow = 1, axes = "collect", guides = "collect") +
    plot_annotation(title = "Which Languages Have Higher Pay?",
        subtitle = "All sets of plots are the exact same except for colour") &
    theme(legend.position = "bottom")
```

- More languages appears to be associated with more pay.
    - Especially if that language is SQL, it would seem.
        - Note that SQL alone doesn't get you a high salary.
    - Adding Julia also seems to increase pay, but this is likely not causal. Perhaps those who need to learn Julia are in a better job already, rather than learning Julia and then getting a better job.
    - Python+SQL and R+SQL seem to be the best bang for your buck - with just two languages, you get almost the full benefit of Python+R+SQL+Julia

## Model Plot 3: Wage, Age, and Educage

```{r}
so_cad |>
    filter(!Age %in% c("Prefer not to say", "Under 18 years old")) |>
    filter(CompCAD < 500000) |>
    mutate(
        EdLevel = fct_relevel(
            EdLevel,
            c("Secondary", "Some College/University", "Bachelor’s",
                "Master’s", "Associate", "Professional", "Other")
        )
    ) |>
    ggplot() +
    aes(x = EdLevel, y = CompCAD, fill = Age) +
    geom_violin(scale = "count") + # Widths proportional to amount of data
    facet_wrap(~ Age) +
    coord_flip()
```

- For people 35-44 or 45-54 years old, a Master's means they make *less* money!?!
    - Maybe the master's degree was in a different field than data science?
- Professional Degrees appear to help a lot!
- Very few people (especially yhose older than 25) have only a Seconday School education. 
- A surprising number of people in the 18-24 range have a Bachelor's degree.
    - They may have answer "Bachelor's" even if they aren't yet completed?

# Exploratory Modelling



